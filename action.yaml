name: 'PR Check Status Notifier JS'
description: 'Monitors PR checks and notifies when all checks (except specified ones) have passed'
author: 'Tim Fall'

inputs:
  github-token:
    description: 'GitHub token for API access'
    required: true
    default: ${{ github.token }}
  excluded-checks:
    description: 'Comma-separated list of check names to exclude'
    required: false
    default: 'atlantis/apply,Check Status & Notify'
  notification-message:
    description: 'Custom notification message (use {user} for PR owner mention)'
    required: false
    default: '@{user} All checks have passed! âœ…\nThis PR is ready for `atlantis apply` and merge.\n\n*Note*: The `atlantis apply` status check will show as passed after running the command.'
  poll-interval:
    description: 'Polling interval in seconds'
    required: false
    default: '30'
  timeout:
    description: 'Maximum time to wait in minutes'
    required: false
    default: '30'

runs:
  using: 'composite'
  steps:
    - uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install dependencies
      shell: bash
      run: |
        npm install
    
    - name: Run status checker
      shell: bash
      run: node src/index.js
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
        EXCLUDED_CHECKS: ${{ inputs.excluded-checks }}
        POLL_INTERVAL: ${{ inputs.poll-interval }}
        TIMEOUT_MINUTES: ${{ inputs.timeout }}
        NOTIFICATION_MESSAGE: ${{ inputs.notification-message }}